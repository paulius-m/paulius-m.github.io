<html>
<head>
<!-- Create a simple CodeMirror instance -->
<link rel="stylesheet" href="lib/codemirror.css">
<link rel="stylesheet" href="codemirror/theme/neat.css">

<style lang="css">
.editor {
    border: 1px solid;
	height: auto;
}
.flex {
    display: flex;
	align-items: stretch;
}


.flex-columns {
    display: flex;
	flex-direction: column;
}

.flex-item-editor{
    flex-grow: 1;
    flex-shrink: 1;
    flex-basis: 40px;
}

.flex-item-game {
    flex-grow: 0;
    flex-shrink: 0;
    flex-basis: auto;
	max-height: 640px;
}
.CodeMirror{
	height: 100%;
	max-height: 640px;
}
</style>

</head>
<body style="max-height: 640px;">
<button id="run" style="flex-grow: 0">Run</button>
<div class="flex" >
    <div class="flex-item-editor flex-columns">
		<textarea id="demotext" class="flex-item-editor" style="display: none;">
function diver_move (count) {
  for (let i = 0; i < count; i++)
  	diver.move();
}

diver_move(4);
diver.turn(right);
diver_move(7);
diver.turn(right);
diver_move(3);
diver.pick();
diver.turn();
diver_move(2);
diver.drop();
diver.turn(left);
diver.move();

diver.turn(right);
diver.move();
diver.turn(right);
diver.pick();
diver_move(3);

diver.drop();

diver.turn();
diver.turn();
diver_move(3);
diver.turn(left);

diver_move(3);
diver.turn(left);
diver_move(4);
diver.turn(left);

diver.move()
diver.move();

diver.pick();
diver_move(4);
</textarea>
    </div>
    <div class="flex-item-game" id="content">
    </div>
</div>

<script src="lib/codemirror.js"></script>
<script src="codemirror/addon/edit/matchbrackets.js"></script>
<script src="codemirror/addon/comment/continuecomment.js"></script>
<script src="codemirror/addon/comment/comment.js"></script>
<script src="codemirror/mode/javascript/javascript.js"></script>

<script src="kiwi/kiwi.js"></script>
<script src="kiwi/kiwipreloader.js"></script>
<script type="text/javascript" src="src/diver.js"></script>
<script type="text/javascript" src="src/states/play.js"></script>
<script type="text/javascript" src="src/states/intro.js"></script>
<script type="text/javascript" src="src/states/loading.js"></script>
<script type="text/javascript" src="src/states/gameover.js"></script>
<script type="text/javascript" src="src/game.js"></script>

<script>
    var editor = CodeMirror.fromTextArea(demotext, {
        lineNumbers: true,
        matchBrackets: true,
        continueComments: "Enter",
        theme: "neat",
        extraKeys: {"Ctrl-Q": "toggleComment"},
		viewportMargin: Infinity
    });
	
	editor.setValue(localStorage.getItem('code'));
	
    run.addEventListener('click', function() {
        try{
        eval(editor.getValue());
        } catch(e) {
            console.log(e)
        }
    });
	
	window.addEventListener('beforeunload', function() {
		localStorage.setItem("code", editor.getValue());
	});
	
</script>

</body>
</html>